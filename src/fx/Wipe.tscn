[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/image/wipe.png" type="Texture" id=1]
[ext_resource path="res://assets/audio/sfx/wipe.wav" type="AudioStream" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Node2D

var sprite : Sprite
var sprites : Node2D

export var act = false
export var backwards = false

var tick = 0.03
var clock = 0

var frame = 0
# last frame
export var last = 14

signal finish

var audio : AudioStreamPlayer2D

# Called when the node enters the scene tree for the first time.
func _ready():
	sprite = $Sprites/Sprite.duplicate()
	$Sprites/Sprite.queue_free()
	sprites = $Sprites
	audio = $AudioStreamPlayer2D
	
	for y in 12:
		for x in 21:
			var s = sprite.duplicate()
			s.position = Vector2(x, y) * 16
			sprites.add_child(s)
	
	start() if act else stop(false)

func _process(delta):
	clock -= delta
	if clock < 0:
		clock += tick
		frame += 1
		
		if frame > last:
			sprites.visible = false
			stop()
			return
		
		for i in sprites.get_children():
			i.frame = clamp(last - frame if backwards else frame, 0, last)

func start(_backwards = false):
	act = true
	set_process(true)
	frame = 0
	clock = tick
	backwards = _backwards
	sprites.visible = true
	#audio.play()

func stop(_emit_signal = true):
	act = false
	set_process(false)
	sprites.visible = false
	
	if _emit_signal:
		emit_signal(\"finish\")


"

[node name="Wipe" type="Node2D"]
script = SubResource( 1 )

[node name="Sprites" type="Node2D" parent="."]

[node name="Sprite" type="Sprite" parent="Sprites"]
texture = ExtResource( 1 )
hframes = 4
vframes = 4
region_rect = Rect2( 0, 0, 16, 16 )

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 2 )
